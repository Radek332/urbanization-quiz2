<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urbanization Mastery Quiz</title>
    <style>
        :root { --primary: #3498db; --success: #27ae60; --error: #e74c3c; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .header-box { width: 100%; max-width: 600px; text-align: center; margin-bottom: 20px; }
        .score-box { font-size: 1.2rem; font-weight: bold; color: var(--primary); background: white; padding: 10px 20px; border-radius: 50px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: inline-block; }
        .card { background: white; width: 100%; max-width: 600px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 25px; box-sizing: border-box; }
        .question-text { font-size: 1.2rem; font-weight: 600; color: #2c3e50; margin-bottom: 15px; display: block; }
        .option { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #edeff0; border-radius: 12px; background: white; text-align: left; font-size: 1rem; cursor: pointer; transition: 0.2s; box-sizing: border-box; }
        .option:hover { border-color: var(--primary); background-color: #f0f9ff; }
        .hint-btn { background: #95a5a6; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; margin-bottom: 15px; font-size: 0.85rem; }
        .hint-text { display: none; font-style: italic; color: #7f8c8d; margin-bottom: 15px; background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 0.9rem; }
        .feedback { margin-top: 15px; padding: 15px; border-radius: 10px; display: none; font-size: 0.95rem; line-height: 1.5; }
        .correct-msg { background-color: #d4edda; color: #155724; border-left: 5px solid var(--success); }
        .wrong-msg { background-color: #f8d7da; color: #721c24; border-left: 5px solid var(--error); }
        textarea { width: 100%; height: 120px; padding: 15px; border-radius: 12px; border: 2px solid #ddd; font-family: inherit; font-size: 1rem; box-sizing: border-box; margin-bottom: 10px; }
        .btn { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: bold; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="header-box">
        <h1>Urbanization Quiz</h1>
        <div id="score-counter" class="score-box">Score: 0 / 11</div>
    </div>

    <div id="quiz-area" style="width:100%; max-width:600px;"></div>

    <div id="frq-card" class="card" style="display:none;">
        <h2 style="margin-top:0;">Final Challenge: AI Graded</h2>
        <p><strong>Question:</strong> How does urbanization change the local water cycle? Mention concepts like runoff or groundwater.</p>
        <textarea id="frq-input" placeholder="Type your answer here..."></textarea>
        <div id="ai-status" style="font-style:italic; font-size:0.8rem; color:#7f8c8d;">AI is waiting for your response...</div>
        <button class="btn" id="frq-submit" onclick="gradeFRQ()">SUBMIT FOR AI GRADING</button>
        <div id="frq-feedback" class="feedback"></div>
    </div>

    <div id="results" class="card" style="display:none; text-align:center;">
        <h2 style="color: var(--success);">Quiz Complete!</h2>
        <div id="final-score-display" style="font-size: 4rem; font-weight:bold; margin: 20px 0;"></div>
        <button class="btn" onclick="location.reload()" style="background:#34495e;">Restart Quiz</button>
    </div>

    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/951/951-preview.mp3"></audio>

    <script>
        const quizData = [
            { q: "What causes the 'Urban Heat Island' effect?", options: ["Wind blocking", "Absorption by dark surfaces", "Waste heat", "Cloud cover"], correct: 1, hint: "Asphalt gets very hot in the sun.", explanation: "Dark surfaces like asphalt absorb heat, and cities lack plants for cooling." },
            { q: "How do impervious surfaces affect the water cycle?", options: ["Increase recharge", "Decrease runoff", "Reduce evaporation", "Increase runoff and pollutants"], correct: 3, hint: "Water can't soak into concrete.", explanation: "Pavement prevents water from soaking in, forcing it to rush into drains as polluted runoff." },
            { q: "What drives saltwater intrusion?", options: ["Sea level rise", "Freshwater pumping", "Road salt", "Building foundations"], correct: 1, hint: "Taking too much water out of the ground.", explanation: "Excessive pumping of aquifers allows saltwater to leak into the city's supply." },
            { q: "Which is a hallmark of 'Urban Sprawl'?", options: ["High-density", "Low-density expansion", "Mixed-use", "Vertical growth"], correct: 1, hint: "Spreading out horizontally.", explanation: "Sprawl is low-density expansion into rural areas, increasing car reliance." },
            { q: "How does urbanization disrupt the Carbon Cycle?", options: ["More trees", "Fossil fuel combustion", "Asphalt trapping CO2", "Lower population"], correct: 1, hint: "Cities use lots of energy and cars.", explanation: "Concentrated human activity releases massive amounts of CO2 into the atmosphere." },
            { q: "Why is Land Remediation useful?", options: ["Turns forests to malls", "Cleans city land for reuse", "Makes farms cheaper", "Increases car use"], correct: 1, hint: "Recycling old urban land.", explanation: "Cleaning contaminated sites allows new buildings without destroying nature." },
            { q: "What is a drawback of sprawl?", options: ["Cheap infrastructure", "Exercise", "High infrastructure costs", "Better air"], correct: 2, hint: "Longer pipes and longer drives.", explanation: "Sprawl is expensive to maintain and increases social isolation." },
            { q: "What does 'Habitat Fragmentation' lead to?", options: ["Biodiversity", "Loss of ecosystem services", "Migration", "Soil nutrients"], correct: 1, hint: "Splitting nature into small pieces.", explanation: "Breaking up habitats makes it hard for wildlife to survive and migrate." },
            { q: "How does vegetation cool a city?", options: ["Shade & evapotranspiration", "Sucking CO2", "Solar power", "Reflecting light"], correct: 0, hint: "Plants release water vapor.", explanation: "Shade and the release of water vapor cool the air naturally." },
            { q: "What efficiency is gained by high-density?", options: ["More land", "Higher infrastructure efficiency", "More cars", "Less noise"], correct: 1, hint: "Serving many people with one pipe.", explanation: "High-density living is much more cost and energy efficient for a city." }
        ];

        let score = 0;
        let answered = 0;

        function renderQuiz() {
            const area = document.getElementById('quiz-area');
            quizData.forEach((item, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <span class="question-text">${idx+1}. ${item.q}</span>
                    <button class="hint-btn" onclick="document.getElementById('hint-${idx}').style.display='block'">Need a hint?</button>
                    <div id="hint-${idx}" class="hint-text">${item.hint}</div>
                    <div id="options-${idx}">${item.options.map((opt, i) => `<button class="option" onclick="check(${idx}, ${i})">${opt}</button>`).join('')}</div>
                    <div id="feedback-${idx}" class="feedback"></div>`;
                area.appendChild(card);
            });
        }

        function check(qIdx, choice) {
            const feed = document.getElementById(`feedback-${qIdx}`);
            const buttons = document.getElementById(`options-${qIdx}`).querySelectorAll('.option');
            buttons.forEach(b => b.disabled = true);
            if(choice === quizData[qIdx].correct) {
                score++; document.getElementById('sound-correct').play();
                feed.innerHTML = `<strong>Correct!</strong> ${quizData[qIdx].explanation}`;
                feed.className = "feedback correct-msg";
            } else {
                document.getElementById('sound-wrong').play();
                feed.innerHTML = `<strong>Incorrect.</strong> ${quizData[qIdx].explanation}`;
                feed.className = "feedback wrong-msg";
            }
            feed.style.display = "block"; answered++;
            document.getElementById('score-counter').innerText = `Score: ${score} / 11`;
            if(answered === quizData.length) document.getElementById('frq-card').style.display = 'block';
        }

        function gradeFRQ() {
            const input = document.getElementById('frq-input').value.toLowerCase();
            const feed = document.getElementById('frq-feedback');
            document.getElementById('ai-status').innerText = "AI is grading...";
            document.getElementById('frq-submit').disabled = true;

            setTimeout(() => {
                const keywords = ["runoff", "impervious", "groundwater", "recharge", "pavement", "pollut"];
                let frqScore = 0;
                keywords.forEach(k => { if(input.includes(k)) frqScore += 0.5; });
                if(frqScore > 1) frqScore = 1;

                score += frqScore;
                feed.style.display = 'block';
                feed.className = frqScore >= 1 ? "feedback correct-msg" : "feedback wrong-msg";
                feed.innerHTML = `<strong>AI Score: ${frqScore}/1</strong><br>The AI looked for keywords like 'runoff' and 'impervious'.`;
                
                setTimeout(() => {
                    document.getElementById('quiz-area').style.display = 'none';
                    document.getElementById('frq-card').style.display = 'none';
                    document.getElementById('results').style.display = 'block';
                    document.getElementById('final-score-display').innerText = `${score.toFixed(1)} / 11`;
                }, 2000);
            }, 1500);
        }

        renderQuiz();
    </script>
</body>
</html>
